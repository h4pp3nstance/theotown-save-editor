<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TheoTown Save Editor</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üèôÔ∏è</text></svg>">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>TheoTown Save Editor</h1>
            <p class="version">v3.0</p>
        </header>
        
        <div id="error"></div>
        <div id="success"></div>
        <div id="changesIndicator">Unsaved changes</div>
        
        <div id="loader">
            <div class="spinner"></div>
            <p>Loading...</p>
        </div>
        
        <div id="dropZone">
            <h2>Select City File</h2>
            <p>Drop a .city file here or click to browse</p>
            <label class="file-label">
                <input type="file" id="fileInput" accept=".city">
                Choose File
            </label>
        </div>
        
        <div id="editor">
            <section class="panel">
                <h2>City Info</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <label>Name</label>
                        <span id="cityName">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <label>Size</label>
                        <span id="citySize">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <label>Version</label>
                        <span id="cityVersion">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <label>Difficulty</label>
                        <span id="cityGamemode">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <label>Population</label>
                        <span id="cityPopulation">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <label>Playtime</label>
                        <span id="cityPlaytime">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <label>Saves</label>
                        <span id="citySaves">‚Äî</span>
                    </div>
                    <div class="info-item">
                        <label>Modified</label>
                        <span id="cityLastModified">‚Äî</span>
                    </div>
                </div>
            </section>
            
            <section class="panel">
                <h2>Edit Values</h2>
                <p class="panel-note">Changes are written directly to binary data</p>
                <table class="edit-table">
                    <thead>
                        <tr>
                            <th>Field</th>
                            <th>Value</th>
                            <th>Offset</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="cityNameRow">
                            <td>Name</td>
                            <td><input type="text" id="binaryName" maxlength="255"></td>
                            <td class="offset" id="nameOffset">‚Äî</td>
                            <td>
                                <span class="tooltip">?
                                    <span class="tooltip-text">Binary: name</span>
                                </span>
                            </td>
                        </tr>
                        <tr id="binaryEstateRow">
                            <td>Money</td>
                            <td><input type="number" id="binaryEstate" min="0" max="2147483647"></td>
                            <td class="offset" id="estateOffset">‚Äî</td>
                            <td>
                                <span class="tooltip">?
                                    <span class="tooltip-text">Binary: estate (int32)</span>
                                </span>
                            </td>
                        </tr>
                        <tr id="binaryRankRow">
                            <td>Rank</td>
                            <td><input type="number" id="binaryRank" min="0" max="64"></td>
                            <td class="offset" id="rankOffset">‚Äî</td>
                            <td>
                                <span class="tooltip">?
                                    <span class="tooltip-text">Binary: rank lvl (0-64)</span>
                                </span>
                            </td>
                        </tr>
                        <tr id="gamemodeRow">
                            <td>Difficulty</td>
                            <td>
                                <select id="gamemodeSelect" class="gamemode-select">
                                    <option value="EASY">EASY</option>
                                    <option value="NORMAL">NORMAL</option>
                                    <option value="HARD">HARD</option>
                                    <option value="SANDBOX">SANDBOX</option>
                                </select>
                            </td>
                            <td class="offset" id="gamemodeOffset">‚Äî</td>
                            <td>
                                <span class="tooltip">?
                                    <span class="tooltip-text">Binary: gamemode</span>
                                </span>
                            </td>
                        </tr>
                        <tr id="uberRow">
                            <td>Uber Mode</td>
                            <td><span id="uberStatus" class="status-off">OFF</span></td>
                            <td class="offset" id="uberOffset">‚Äî</td>
                            <td><button class="btn btn-small btn-secondary" id="toggleUberBtn">Toggle</button></td>
                        </tr>
                        <tr id="dsaRow">
                            <td>DSA Supplies</td>
                            <td><input type="number" id="dsaSupplies" min="0" max="32767"></td>
                            <td class="offset" id="dsaOffset">‚Äî</td>
                            <td>
                                <span class="tooltip">?
                                    <span class="tooltip-text">Binary: dsarocketprocentage</span>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </section>
            
            <section class="panel">
                <h2>Save</h2>
                <div id="validationStatus" class="validation-status"></div>
                <div id="backupStatus" class="backup-status"></div>
                <div class="actions">
                    <button class="btn btn-secondary" id="undoBtn" disabled>Undo</button>
                    <button class="btn btn-secondary" id="redoBtn" disabled>Redo</button>
                    <button class="btn btn-primary" id="saveBtn">Save File</button>
                    <button class="btn btn-secondary" id="downloadOriginalBtn" style="display:none;">Original</button>
                    <button class="btn btn-secondary" id="resetBtn">Reset</button>
                    <button class="btn btn-secondary" id="closeBtn">Close</button>
                </div>
            </section>
        </div>
        
        <footer>
            <p>TheoTown Save Editor</p>
            <p>Ctrl+Z Undo ¬∑ Ctrl+Y Redo ¬∑ Ctrl+S Save</p>
        </footer>
    </div>
    
    <script src="js/core/binary.js"></script>
    <script src="js/core/parser.js"></script>
    <script src="js/core/validator.js"></script>
    <script src="js/core/backup.js"></script>
    <script src="js/core/history.js"></script>
    <script src="js/editor/fields.js"></script>
    <script src="js/editor/city.js"></script>
    <script src="js/ui/display.js"></script>
    <script src="js/ui/actions.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            Actions.init();
        });
    </script>
</body>
</html>
